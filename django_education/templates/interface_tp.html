<!DOCTYPE html>
<html>
{% load static %}
   <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="{% static "css/graph.css" %}" rel="stylesheet">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Réponse temporelle</title>
	<script src="https://www.chartjs.org/dist/2.9.3/Chart.js"></script>
  <script src="{% static "js/rSlider.min.js" %}"></script>
  <link href="{% static "css/rSlider.min.css" %}" rel="stylesheet">

</head>

  <body onload="init()">
    {% csrf_token %}

  <div class="container-fluid">
      <div class="row">
        <div class="col-sm">
			<canvas id="canvas"></canvas>

		</div>
                  <div class="col-sm">
         <h1>Paramétrage du tracé:</h1>
         <label>Ordre:</label>
                      <div class="form-check">
        <input class="form-check-input" type="radio" name="function" value="premier" id="premier-option" onchange="calculateQTc();" checked>
        <label class="form-check-label" for="premier-option">
          Premier ordre
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="function" value="second" id="second-option" onchange="calculateQTc();">
        <label class="form-check-label" for="second-option">
          Second ordre
        </label>
     </div>
     <br>
     {% for slider in sliders%}
    <div id="div{{slider.name}}">
     <label>{{slider.label}}</label>
    <input type="text" id="{{slider.name}}" />
    </div>
    {% endfor %}
     <br>
  <!--       <input type="submit" name="next" id="next"  value="Next" onclick="calculateQT();">-->
    <br>
<!--     <input id="fileInput" type="file" name="file" />-->
        <pre id="fileContent"></pre>
            <button onclick="download_csv_file()"> Download CSV </button>
     <div id="qtc-results">
     <h2>Resultats</h2>
     <p>Ecart simulé/réel = <span id="qtc">   </span>.
     <br>
     <p><span id="prolonged"></span></p>
     </div>
		</div>
	</div>
</div>

</div>

<script src="{% static "js/graph.js" %}"></script>
<script>

{% for slider in sliders%}
var mySlider{{slider.name}} = new rSlider({
        target: '{{slider.target}}',
        values: {{slider.val}},
        //step: {{slider.step}},
        range: false,
        tooltip: true,
        scale: true,
        labels: false,
        set: {{slider.set}},
        onChange: function (vals) {
                        calculateQTc();;
                    }
    });
{% endfor %}

//create a user-defined function to download CSV file
function download_csv_file() {

    //define the heading for each row of the data
    var csv = 'temps;Simulé;Réel\n';

    //merge the data with CSV
    dataexp.forEach(function(row) {
            csv += row.join(';');
            csv += "\n";
    });

    var hiddenElement = document.createElement('a');
    hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
    hiddenElement.target = '_blank';

    //provide the name for the CSV file to be downloaded
    hiddenElement.download = 'export.csv';
    hiddenElement.click();
}

</script>
  </body>
</html>
